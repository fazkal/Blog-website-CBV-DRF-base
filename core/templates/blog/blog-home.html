{% extends 'base.html' %}
{% load static %}
{% block content %}

			<!-- start banner Area -->
			<section class="banner-area relative blog-home-banner" id="home">	
				<div class="overlay overlay-bg"></div>
				<div class="container">				
					<div class="row d-flex align-items-center justify-content-center">
						<div class="about-content blog-header-content col-lg-12">
							<h1 class="text-white">
								Dude You’re Getting
								a Telescope				
							</h1>	
							<p class="text-white">
								There is a moment in the life of any aspiring astronomer that it is time to buy that first
							</p>							
						</div>	
					</div>
				</div>
			</section>
			<!-- End banner Area -->				  

			<!-- Start top-category-widget Area -->
			<section class="top-category-widget-area pt-90 pb-90 ">
				<div class="container">
					<div class="row">		
						<div class="col-lg-4">
							<div class="single-cat-widget">
								<div class="content relative">
									<div class="overlay overlay-bg"></div>
								    <a href="#" target="_blank">
								      <div class="thumb">
								  		 <img class="content-image img-fluid d-block mx-auto" src="#" alt="">
								  	  </div>
								      <div class="content-details">
								        <h4 class="content-title mx-auto text-uppercase">Social life</h4>
								        <span></span>								        
								        <p>Enjoy your social life together</p>
								      </div>
								    </a>
								</div>
							</div>
						</div>
						<div class="col-lg-4">
							<div class="single-cat-widget">
								<div class="content relative">
									<div class="overlay overlay-bg"></div>
								    <a href="#" target="_blank">
								      <div class="thumb">
								  		 <img class="content-image img-fluid d-block mx-auto" src="#" alt="">
								  	  </div>
								      <div class="content-details">
								        <h4 class="content-title mx-auto text-uppercase">Politics</h4>
								        <span></span>								        
								        <p>Be a part of politics</p>
								      </div>
								    </a>
								</div>
							</div>
						</div>
						<div class="col-lg-4">
							<div class="single-cat-widget">
								<div class="content relative">
									<div class="overlay overlay-bg"></div>
								    <a href="#" target="_blank">
								      <div class="thumb">
								  		 <img class="content-image img-fluid d-block mx-auto" src="#" alt="">
								  	  </div>
								      <div class="content-details">
								        <h4 class="content-title mx-auto text-uppercase">Food</h4>
								        <span></span>
								        <p>Let the food be finished</p>
								      </div>
								    </a>
								</div>
							</div>
						</div>												
					</div>
				</div>	
			</section>
			<!-- End top-category-widget Area -->
			
			<!-- Start post-content Area -->
			<section class="post-content-area">
				<div class="container">
					<div class="row">
						<div class="col-lg-8 posts-list">
							
							<div class="single-post row">
								<!--<div class="col-lg-3  col-md-3 meta-details">
									<ul class="tags">
										
										<li><a href="#"></a></li>
										
										
									</ul>
									<div class="user-details row">
										<p class="user-name col-lg-12 col-md-12 col-6"><a href="#"></a> <span class="lnr lnr-user"></span></p>
										<p class="date col-lg-12 col-md-12 col-6"><a href="#"></a> <span class="lnr lnr-calendar-full"></span></p>
										<p class="view col-lg-12 col-md-12 col-6"><a href="#"> Views</a> <span class="lnr lnr-eye"></span></p>
										<p class="comments col-lg-12 col-md-12 col-6"><a href="#"> Comments</a> <span class="lnr lnr-bubble"></span></p>						
									</div>
								</div>-->
								<div class="col-lg-9 col-md-9 ">
									<div class="feature-img">
										<img class="img-fluid" src="#" alt="">
									</div>
									<div id="posts-title" ><h3></h3></div>
									<p class="excert">
										
									</p>
									<a href="#" class="primary-btn">Create Post</a>
								</div>
							</div>
							<div class=" pagination-container">

							</div>										
		                    <!--<nav class="blog-pagination justify-content-center d-flex">
		                      <ul class="paginations">
								
		                            <li class="page-item">
		                                <a class="page-link1" aria-label="Previous">
		                                    <span aria-hidden="true">
		                                        <span class="lnr lnr-chevron-left"></span>
		                                    </span>
		                                </a>
		                            </li>
									
		                            <li class="page-item"><a href="?page={{i}}" class="page-link"></a></li>
		                            
		                           
		                           
									<li class="page-item">
		                                <a class="page-link2" aria-label="Next">
		                                    <span aria-hidden="true">
		                                        <span class="lnr lnr-chevron-right"></span>
		                                    </span>
		                                </a>
		                            </li>
									
		                     	</ul> 
								 
							</nav> -->
						</div>
						<div class="col-lg-4 sidebar-widgets">
							<div class="widget-wrap">
								<div class="single-sidebar-widget search-widget">
									<form id="search-form" >
										<input id="search-input" placeholder="Search Posts" name="search" type="text" onfocus="this.placeholder = ''" onblur="this.placeholder = 'Search Posts'" >
										<button type="submit"><i class="fa fa-search"></i></button>
									</form>
								</div>
								<div class="single-sidebar-widget ads-widget">
									<a href="#"><img class="img-fluid" src="#" alt=""></a>
								</div>
							
								<div class="single-sidebar-widget newsletter-widget">
									<h4 class="newsletter-title">Newsletter</h4>
									<p>
										Here, I focus on a range of items and features that we use in life without
										giving them a second thought.
									</p>
									<div class="form-group d-flex flex-row">
									   <div class="col-autos">
									      <div class="input-group">
									        <div class="input-group-prepend">
									          <div class="input-group-text"><i class="fa fa-envelope" aria-hidden="true"></i>
											</div>
									        </div>
									        <input type="text" class="form-control" id="inlineFormInputGroup" placeholder="Enter email" onfocus="this.placeholder = ''" onblur="this.placeholder = 'Enter email'" >
									      </div>
									    </div>
									    <a href="#" class="bbtns">Subcribe</a>
									</div>	
									<p class="text-bottom">
										You can unsubscribe at any time
									</p>								
								</div>
								{% include 'blog/blog-tags.html' %}							
							</div>
						</div>
					</div>
				</div>	
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"
    integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" 
    crossorigin="anonymous" referrerpolicy="no-referrer">
</script>
<script>
let currentPage = 1;
let postsPerPage = 4; // تعداد پست در هر صفحه
let totalPosts = 0; // مقدار اولیه
let allPosts = []; // برای ذخیره تمام پست ها

function fetchPosts(page) {
  $.get('/blog/api/v1/post/?page=' + page, function(data, textStatus, jqXHR) {
    totalPosts = data.total_objects; // تعداد کل پست‌ها را دریافت می‌کنیم
    allPosts = allPosts.concat(data.results); // پست های صفحه جاری را به لیست کلی اضافه می کنیم

    displayPosts(data.results, page, Math.ceil(totalPosts / postsPerPage));
    
    if(page < Math.ceil(totalPosts / postsPerPage)){
        //اگر هنوز صفحه بعدی وجود دارد
        currentPage++;
        fetchPosts(currentPage);
    }
  });
}

function displayPosts(posts, currentPage, totalPages) {
  const wrapperTitle = $('#posts-title');
  const wrapperContent = $('.excert');
  wrapperTitle.empty(); // محتوای قبلی را پاک می‌کنیم
  wrapperContent.empty(); // محتوای قبلی را پاک می‌کنیم

  for (const post of posts) {
    wrapperTitle.append(`<img src="${post.image}" width="500px" height="250px"><br>
                         <a href="/blog/${post.id}"><h5>${post.title}</h5></a>
                         <p>${post.snippet}</p><hr>`);
  }

  // اضافه کردن لینک‌های صفحه بندی
  let paginationHtml = '<div class="pagination">';
  if (currentPage > 1) {
    paginationHtml += `<a href="#" onclick="fetchPosts(${currentPage - 1})">Previous</a> `;
  }
  paginationHtml += `Page ${currentPage} of ${totalPages}`;
  if (currentPage < totalPages) {
    paginationHtml += ` <a href="#" onclick="fetchPosts(${currentPage + 1})">Next</a>`;
  }
  paginationHtml += '</div>';
  $('.pagination-container').html(paginationHtml); // فرض می‌شود که یک عنصر با کلاس pagination-container وجود دارد.
}

// شروع فراخوانی API از صفحه اول
fetchPosts(1);

</script>
<script>
    $(document).ready(function() {  // Wait for document to be ready
        $('#search-form').submit(function(event) {
            event.preventDefault();

            var searchTerm = $('#search-input').val();
            var searchUrl = 'http://127.0.0.1:8000/blog/api/v1/post/?search=' + searchTerm;

            fetch(searchUrl)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.json();
                })
                .then(data => {
                    displayResults(data);
                })
                .catch(error => {
                    console.error('There was a problem with the fetch operation:', error);
                    $('#posts-title').html('Error fetching data.');
                });

            function displayResults(data) {
                var postsTitleDiv = $('#posts-title');  // Use jQuery to select the element
                postsTitleDiv.empty();  // Use jQuery to empty the element

                if (data && data.length > 0) {
                    data.forEach(item => {
                        var title = item.title;
                        var snippet = item.snippet;

                        // Use jQuery to append the content
                        postsTitleDiv.append(`<div><h3>${title}</h3><p>${snippet}</p><hr></div>`);
                    });
                } else {
                    postsTitleDiv.html('<p>No results found.</p>');  // Use jQuery to set the content
                }
            }
        });
    });
</script>
<!-- در انتهای <body> در صفحه ای که لینک قرار دارد -->
	<script>
		$(document).ready(function(){
			$('.primary-btn').click(function(e){
				e.preventDefault();
				$.ajax({
					url: "{% url 'blog:post_form' %}",  // Use the name of the new URL
					type: 'GET',
					success: function(data){
						$('.modal-body').html(data); // Insert form content into modal body
						$('#postModal').modal('show'); // Show the modal
						// Attach submit handler to the form in the modal
						$('form').submit(function(e) {
							e.preventDefault();
							var formData = new FormData(this);
							$.ajax({
								url: "{% url 'blog:create' %}", // Use the name of the create URL
								type: 'POST',
								data: formData,
								processData: false,
								contentType: false,
								success: function(response) {
									$('#postModal').modal('hide');  // Hide modal on success
									// Optionally refresh the page or update the post list
									location.reload();  // Refresh the current page
								},
								error: function(xhr, status, error) {
									// Handle errors (e.g., display error messages in the modal)
									$('.modal-body').html(xhr.responseText); // Display error messages
								}
							});
						});
					},
					error: function(xhr, status, error){
						console.error("Error loading form:", error);
					}
				});
			});
		});
	</script>
	
			</section>
			<!-- End post-content Area -->
	
{% endblock %}